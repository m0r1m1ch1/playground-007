@use 'sass:math';
@use 'sass:meta';
@use './variables' as var;

@function round-decimal($number, $digits: 0) {
  @return to-fixed($number, $digits, 'round');
}

@function ceil-decimal($number, $digits: 0) {
  @return to-fixed($number, $digits, 'ceil');
}

@function floor-decimal($number, $digits: 0) {
  @return to-fixed($number, $digits, 'floor');
}

@function to-fixed($number, $digits: 0, $round: 'round') {
  $n: 1;

  // $number must be a number
  @if meta.type-of($number) != number {
    @warn '#{ $number } is not a number.';
    @return $number;
  }

  // $digits must be a unitless number
  @if meta.type-of($digits) != number {
    @warn '#{ $digits } is not a number.';
    @return $number;
  } @else if not math.is-unitless($digits) {
    @warn '#{ $digits } has a unit.';
    @return $number;
  }

  @for $I from 1 through $digits {
    $n: $n * 10;
  }

  @if $round == 'round' {
    @return calc(math.round($number * $n) / $n);
  } @else if $round == 'ceil' {
    @return calc(math.ceil($number * $n) / $n);
  } @else if $round == 'floor' {
    @return calc(math.floor($number * $n) / $n);
  } @else {
    @warn '#{ $round } is undefined keyword.';
    @return $number;
  }
}

@function auto-round-decimal($number) {
  @if $number >= 1 {
    @return round-decimal($number, 3);
  } @else if $number >= 0.1 {
    @return ceil-decimal($number, 3);
  } @else if $number >= 0.01 {
    @return ceil-decimal($number, 4);
  } @else if $number >= 0.001 {
    @return ceil-decimal($number, 5);
  } @else if $number >= 0.0001 {
    @return ceil-decimal($number, 6);
  } @else {
    @return ceil-decimal($number, 7);
  }
}

@function fluid-size($bpLower, $bpUpper, $min, $max, $unit: '', $stop: true) {
  $a: 100 * calc(($max - $min) / ($bpUpper - $bpLower));
  $b: $min - calc($bpLower / 100) * $a;
  $n: $min;
  $x: $max;
  $division: 1;
  $times: 1;
  $times-unit: $unit;

  @if $unit == 'rem' {
    $division: var.$rem;
    $times: if($bpUpper >= var.$max-width, var.$one-rem, 1rem);
    $times-unit: '';
  } @else if $unit == 'px' {
    $times: if($bpUpper >= var.$max-width, var.$one-px, 1px);
    $times-unit: '';
  }

  $fluid-value: auto-round-decimal(calc($a / $division / 100)) '+' auto-round-decimal(calc($b / $division));
  $fluid-times: if($unit == '', '', '*' #{$times}#{$times-unit});

  @if $stop {
    @if $min > $max {
      $n: $max;
      $x: $min;
    }

    $start: if($unit == 'px' or $unit == 'rem', calc($n / $division) '*' $times, calc($n / $division * $times));
    $end: if($unit == 'px' or $unit == 'rem', calc($x / $division) '*' $times, calc($x / $division * $times));

    @return clamp(
      #{$start}#{$times-unit},
      (var(--window-width) * #{$fluid-value}) #{$fluid-times},
      #{$end}#{$times-unit}
    );
  } @else {
    @if var.$full-liquid {
      $end: if($unit == 'px' or $unit == 'rem', $x / $division '*' $times, calc($x / $division * $times));

      @if $min > $max {
        @return max(#{$end}#{$times-unit}, (var(--window-width) * #{$fluid-value}) #{$fluid-times});
      } @else {
        @return min(#{$end}#{$times-unit}, (var(--window-width) * #{$fluid-value}) #{$fluid-times});
      }
    } @else {
      @return calc((var(--window-width) * #{$fluid-value}) #{$fluid-times});
    }
  }
}

@function rem($px, $useVar: true) {
  $one-rem: if($useVar, var.$one-rem, 1rem);

  @return #{calc($px / var.$rem * $one-rem)};
}

@function px($px, $useVar: true) {
  $one-rem: if($useVar, var.$one-px, 1rem);

  @return #{calc($px * var.$one-px)};
}

@function duration($value: 1) {
  @return calc(var(--duration) * $value);
}
