---
import type { HTMLAttributes } from 'astro/types';

type Props = {
  class?: string;
  title: string;
} & HTMLAttributes<'div'>;

const { class: className, title, ...rest } = Astro.props;
---

<astro-window>
  <div class={className} {...rest} data-window>
    <div class="title-bar-box" data-title-bar-box>
      <div class="title-bar" data-title-bar>
        <p class="title-bar-title" set:html={title} />
      </div>
    </div>
    <div class="bar"></div>
    <div class="content">
      <slot />
    </div>
  </div>
</astro-window>

<style lang="scss">
  @use '@/styles/extension' as *;

  [data-window] {
    @include shadow;

    position: fixed;
    display: grid;
    grid-template-rows: auto 1fr;
    row-gap: px(2);
    width: fit-content;
    padding: px(6);
    background-color: var(--gray);
  }

  .title-bar {
    @include ms-sans;

    display: grid;
    grid-template-columns: 1fr auto;
    grid-auto-flow: column;
    column-gap: px(10);
    align-items: center;
    padding: px(4) px(8);
    color: var(--white);
    background-color: var(--navy);
  }

  .bar {
    height: px(4);

    // box-shadow:
    //   inset 0 px(calc(var(--shadow-width) * -1)) var(--white),
    //   inset 0 px(calc(var(--shadow-width) * 1)) var(--gray-dark);
    box-shadow: inset 0 px(calc(var(--shadow-width) * 1)) var(--gray-dark);
  }

  .content {
    padding: px(4) px(8);
    background-color: var(--white);

    @include ms-sans;
  }
</style>

<script>
  import { gsap } from 'gsap';
  import { Draggable } from 'gsap/Draggable';

  gsap.registerPlugin(Draggable);
  class AstroWindow extends HTMLElement {
    main = document.querySelector<HTMLDivElement>('main');
    window = this.querySelector<HTMLDivElement>('[data-window]');
    titleBar = this.querySelector<HTMLDivElement>('[data-title-bar]');

    constructor() {
      super();
    }

    connectedCallback() {
      this.init();
    }

    disconnectedCallback() {
      this.destroy();
    }

    init = () => {
      Draggable.create(this.window, {
        type: 'x,y',
        trigger: this.titleBar,
        bounds: this.main,
      });
    };

    destroy = () => {};
  }

  customElements.define('astro-window', AstroWindow);
</script>
